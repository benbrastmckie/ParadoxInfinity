% Formatting for lecture slides

\ProvidesPackage{lectures}

\usetheme[progressbar=frametitle,sectionpage=progressbar,subsectionpage=progressbar,block=fill]{metropolis}
\RequirePackage[a-1b]{pdfx}

% redefine Metropolis colors to fit lecture color scheme; use
% highlightA and highlightB colors

% mLightBrown is the alert color
\colorlet{mLightBrown}{highlightA}
% mLightGreen is the example color
\colorlet{mLightGreen}{highlightB}

\newcommand\hmmax{0}
\newcommand\bmmax{0}

% Use GoSans typeface
\usepackage[sfdefault]{GoSans}
\usepackage{sfmath}

% make progrss bar a bit wider
\setlength{\metropolis@progressinheadfoot@linewidth}{1pt}

% make emphasis bold & alerted
\def\emph#1{\textbf{\alert{#1}}}

\RequirePackage[tracking=alltext]{microtype}

%\RequirePackage[numbered]{bookmark}

\setbeamertemplate{title page}{
  \begin{minipage}[b][\paperheight]{\textwidth}
    \vfill\color{white}%
    \ifx\inserttitle\@empty\else\usebeamertemplate*{title}\fi
    \ifx\insertsubtitle\@empty\else\usebeamertemplate*{subtitle}\fi
    %\usebeamertemplate*{title separator}
    \ifx\beamer@shortauthor\@empty\else\usebeamertemplate*{author}\fi
    \ifx\insertdate\@empty\else\usebeamertemplate*{date}\fi
    \ifx\insertinstitute\@empty\else\usebeamertemplate*{institute}\fi
    \vfill
    \ifx\inserttitlegraphic\@empty\else\inserttitlegraphic\fi
    \vspace*{1cm}
  \end{minipage}}
\setbeamercolor{title}{fg=white}
\setbeamercolor{subtitle}{fg=white}
\setbeamercolor{author}{fg=white}
\setbeamercolor{date}{fg=white}

\setbeamertemplate{itemize item}[triangle]
\setbeamertemplate{itemize subitem}[circle]

\title{\coursename~(\coursenumber)}
\author{\instructor}
\date{\term~\year}

\usepackage[numbered]{bookmark}
\hypersetup{bookmarksnumbered=true,bookmarksopen=true}
\def\thesection{\Roman{section}}
\def\thesubsection{\alph{subsection}}

\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}[subsections numbered]

\setbeamertemplate{section page}{
  \centering
  \begin{minipage}{22em}
    \raggedright
    \usebeamercolor[fg]{section title}
    \usebeamerfont{section title}
    \thesection.~\insertsectionhead\\[-1ex]
    \usebeamertemplate*{progress bar in section page}
    \par
    \ifx\insertsubsectionhead\@empty\else%
      \usebeamercolor[fg]{subsection title}%
      \usebeamerfont{subsection title}%
      \thesubsection.~\insertsubsectionhead
    \fi
  \end{minipage}
  \par
  \vspace{\baselineskip}
  \xdef\subsecframestart{\insertframenumber}
}
\setbeamertemplate  {frame numbering}{\thesection.\thesubsection.\number\numexpr \insertframenumber-\subsecframestart}
%\def\insertframenumber{\thesection.\thesubsection.{\@arabic\c@framenumber}}
\def\subsecframestart{0}

\def\hilitebox#1{\colorbox{highlightbg}{$#1$}}